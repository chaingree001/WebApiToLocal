<!DOCTYPE html><html class="no-js" lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-5V25JL6');
    </script><link href="https://fonts.googleapis.com/css?family=Roboto&amp;display=swap" rel="stylesheet">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="twitter:card" content="summary">
<meta property="og:title" content="ネイティブオーディオプラグイン SDK - Unity マニュアル">
<title>ネイティブオーディオプラグイン SDK - Unity マニュアル</title>
<meta property="og:image" content="https://docs.unity.cn/ja/2021.3/uploads/Main/AudioMixerStereoWidener.jpg">
<meta name="description" content="このページでは、Unity 5.0 に組み込まれたネイティブオーディオプラグインインターフェースについて説明します。いくつかの具体的なプラグイン例について、先へ進むにつれてより複雑なものを見ていきます。こうすることによって、非常に基本的な概念から始めて、ページの終わりの方では、より複雑な使用例を説明します。">
<meta property="og:description" content="このページでは、Unity 5.0 に組み込まれたネイティブオーディオプラグインインターフェースについて説明します。いくつかの具体的なプラグイン例について、先へ進むにつれてより複雑なものを見ていきます。こうすることによって、非常に基本的な概念から始めて、ページの終わりの方では、より複雑な使用例を説明します。">
<meta name="author" content="ユニティ テクノロジーズ">
<link rel="shortcut icon" href="https://unity.com/themes/contrib/unity_base/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFiles/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFiles/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFiles/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFiles/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFiles/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFiles/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFiles/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFiles/images/favicons/tileicon-144x144.png">
<script type="text/javascript" src="" charset="UTF-8" data-domain-script="6e91be4c-3145-4ea2-aa64-89d716064836"></script><script type="text/javascript">
        function OptanonWrapper() { }
    </script><script>
      var docs_type = 'Manual';
      var lang = 'ja';
      var page = 'AudioMixerNativeAudioPlugin';
      if(!page) page = 'index';
      var version = '2021.3';
      var docs_versions = [{version: '2022.1',version_string: '2022.1',supported: true},{version: '2021.3',version_string: '2021.3',supported: true},{version: '2021.2',version_string: '2021.2',supported: false},{version: '2021.1',version_string: '2021.1',supported: false},{version: '2020.3',version_string: '2020.3',supported: true},{version: '2020.2',version_string: '2020.2',supported: false},{version: '2020.1',version_string: '2020.1',supported: false},{version: '2019.4',version_string: '2019.4',supported: true},{version: '2019.3',version_string: '2019.3',supported: false},{version: '2019.2',version_string: '2019.2',supported: false},{version: '2019.1',version_string: '2019.1',supported: false},{version: '2018.4',version_string: '2018.4',supported: false},{version: '2018.3',version_string: '2018.3',supported: false},{version: '2018.2',version_string: '2018.2',supported: false},{version: '2018.1',version_string: '2018.1',supported: false},{version: '2017.4',version_string: '2017.4',supported: false},{version: '2017.3',version_string: '2017.3',supported: false},{version: '2017.2',version_string: '2017.2',supported: false},{version: '2017.1',version_string: '2017.1',supported: false},{version: '5.6',version_string: '560',supported: false},];</script><script type="text/javascript" src="../StaticFiles/js/jquery.js"></script><script type="text/javascript" src="../StaticFiles/js/core.js"></script><script type="text/javascript" src="../StaticFiles/js/jquery.sidebar.min.js"></script><script type="text/javascript" src="docdata/toc.js"></script><script type="text/javascript" src=""></script><script type="text/javascript" src="../StaticFiles/js/custom.js"></script><script type="text/javascript" src="../StaticFiles/js/tinysegmenter.js"></script><link rel="stylesheet" type="text/css" href="../StaticFiles/css/core.css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/custom.css">
<link rel="canonical" href="https://docs.unity.cn/ja/2021.3/Manual/AudioMixerNativeAudioPlugin.html">
<link rel="alternate" href="https://docs.unity.cn/en/2021.3/Manual/AudioMixerNativeAudioPlugin.html" hreflang="en">
<link rel="alternate" href="https://docs.unity.cn/cn/2021.3/Manual/AudioMixerNativeAudioPlugin.html" hreflang="zh">
<link rel="alternate" href="https://docs.unity.cn/ja/2021.3/Manual/AudioMixerNativeAudioPlugin.html" hreflang="ja">
<link rel="alternate" href="https://docs.unity.cn/es/2021.3/Manual/AudioMixerNativeAudioPlugin.html" hreflang="es">
<link rel="alternate" href="https://docs.unity.cn/kr/2021.3/Manual/AudioMixerNativeAudioPlugin.html" hreflang="ko">
<link rel="alternate" href="https://docs.unity.cn/ru/2021.3/Manual/AudioMixerNativeAudioPlugin.html" hreflang="ru">
<link rel="alternate" href="https://docs.unity.cn/2021.3/Documentation/Manual/AudioMixerNativeAudioPlugin.html" hreflang="x-default">
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PVTCJQL');</script>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?69a368c3131f2309a321e386accc19c5";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
</head>
<body>
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5V25JL6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a href="./index.html"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="マニュアル内を検索…" autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul class="menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">マニュアル</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">スクリプトリファレンス</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity.cn/">
                unity.cn
              </a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2021.3</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2022.1" href="/ja/2022.1/Manual/AudioMixerNativeAudioPlugin.html">2022.1</a></li>
<li class="supported"><a class="docs_version_url_2021.3" href="/ja/2021.3/Manual/AudioMixerNativeAudioPlugin.html">2021.3</a></li>
<li class=""><a class="docs_version_url_2021.2" href="/ja/2021.2/Manual/AudioMixerNativeAudioPlugin.html">2021.2</a></li>
<li class=""><a class="docs_version_url_2021.1" href="/ja/2021.1/Manual/AudioMixerNativeAudioPlugin.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.3" href="/ja/2020.3/Manual/AudioMixerNativeAudioPlugin.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/ja/2020.2/Manual/AudioMixerNativeAudioPlugin.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/ja/2020.1/Manual/AudioMixerNativeAudioPlugin.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/ja/2019.4/Manual/AudioMixerNativeAudioPlugin.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/ja/2019.3/Manual/AudioMixerNativeAudioPlugin.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/ja/2019.2/Manual/AudioMixerNativeAudioPlugin.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/ja/2019.1/Manual/AudioMixerNativeAudioPlugin.html">2019.1</a></li>
<li class=""><a class="docs_version_url_2018.4" href="/ja/2018.4/Manual/AudioMixerNativeAudioPlugin.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/ja/2018.3/Manual/AudioMixerNativeAudioPlugin.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/ja/2018.2/Manual/AudioMixerNativeAudioPlugin.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/ja/2018.1/Manual/AudioMixerNativeAudioPlugin.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/ja/2017.4/Manual/AudioMixerNativeAudioPlugin.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/ja/2017.3/Manual/AudioMixerNativeAudioPlugin.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/ja/2017.2/Manual/AudioMixerNativeAudioPlugin.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/ja/2017.1/Manual/AudioMixerNativeAudioPlugin.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/ja/560/Manual/AudioMixerNativeAudioPlugin.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>このページを含むバージョン:</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>このページを含まないバージョン:</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>サポートあり</li>
<li>
<div class="legacy-box"></div>サポートなし、非推奨</li>
</ul>
</div>
</div>
<ul class="nav-menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">マニュアル</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">スクリプトリファレンス</a></li>
</ul>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">言語:
        <span class="b">日本語</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a data-lang="en" href="/2021.3/Documentation/Manual/AudioMixerNativeAudioPlugin.html">English</a></li>
<li><a data-lang="cn" href="/cn/2021.3/Manual/AudioMixerNativeAudioPlugin.html">中文</a></li>
<li><a data-lang="ja" href="/ja/2021.3/Manual/AudioMixerNativeAudioPlugin.html">日本語</a></li>
<li><a data-lang="es" href="/es/2021.3/Manual/AudioMixerNativeAudioPlugin.html">Español</a></li>
<li><a data-lang="kr" href="/kr/2021.3/Manual/AudioMixerNativeAudioPlugin.html">한국어</a></li>
<li><a data-lang="ru" href="/ru/2021.3/Manual/AudioMixerNativeAudioPlugin.html">Русский</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar hidden"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc">
<h2>マニュアル</h2>
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2021.3</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2022.1" href="/ja/2022.1/Manual/AudioMixerNativeAudioPlugin.html">2022.1</a></li>
<li class="supported"><a class="docs_version_url_2021.3" href="/ja/2021.3/Manual/AudioMixerNativeAudioPlugin.html">2021.3</a></li>
<li class=""><a class="docs_version_url_2021.2" href="/ja/2021.2/Manual/AudioMixerNativeAudioPlugin.html">2021.2</a></li>
<li class=""><a class="docs_version_url_2021.1" href="/ja/2021.1/Manual/AudioMixerNativeAudioPlugin.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.3" href="/ja/2020.3/Manual/AudioMixerNativeAudioPlugin.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/ja/2020.2/Manual/AudioMixerNativeAudioPlugin.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/ja/2020.1/Manual/AudioMixerNativeAudioPlugin.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/ja/2019.4/Manual/AudioMixerNativeAudioPlugin.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/ja/2019.3/Manual/AudioMixerNativeAudioPlugin.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/ja/2019.2/Manual/AudioMixerNativeAudioPlugin.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/ja/2019.1/Manual/AudioMixerNativeAudioPlugin.html">2019.1</a></li>
<li class=""><a class="docs_version_url_2018.4" href="/ja/2018.4/Manual/AudioMixerNativeAudioPlugin.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/ja/2018.3/Manual/AudioMixerNativeAudioPlugin.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/ja/2018.2/Manual/AudioMixerNativeAudioPlugin.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/ja/2018.1/Manual/AudioMixerNativeAudioPlugin.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/ja/2017.4/Manual/AudioMixerNativeAudioPlugin.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/ja/2017.3/Manual/AudioMixerNativeAudioPlugin.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/ja/2017.2/Manual/AudioMixerNativeAudioPlugin.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/ja/2017.1/Manual/AudioMixerNativeAudioPlugin.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/ja/560/Manual/AudioMixerNativeAudioPlugin.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>このページを含むバージョン:</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>このページを含まないバージョン:</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>サポートあり</li>
<li>
<div class="legacy-box"></div>サポートなし、非推奨</li>
</ul>
</div>
</div>
<div class="clear"></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap opened-sidebar"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity User Manual 2021.3 (LTS)</a></li>
<li><a href="Audio.html">オーディオ</a></li>
<li>ネイティブオーディオプラグイン SDK</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="AudioMixerUsage.html"></a></span><div class="tip">用途と API の概要</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="AudioSpatializerSDK.html"></a></span><div class="tip">オーディオスペーシャライザー SDK</div>
</div>
</div></div>
<h1>ネイティブオーディオプラグイン SDK</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>このページでは、Unity 5.0 に組み込まれたネイティブオーディオプラグインインターフェースについて説明します。いくつかの具体的なプラグイン例について、先へ進むにつれてより複雑なものを見ていきます。こうすることによって、非常に基本的な概念から始めて、ページの終わりの方では、より複雑な使用例を説明します。</p>

<h2>ダウンロード</h2>

<p>First thing you need to do is to <a href="https://github.com/Unity-Technologies/NativeAudioPlugins">download the newest audio plugin SDK</a>.</p>

<h2>概要</h2>

<p>ネイティブオーディオプラグインシステムは、2 つの部分から構成されます。</p>

<ol>
<li><p>ネイティブ DSP (デジタル信号処理) プラグインは、C または C++ の .dll (Windows) または .dylib (OSX) として実装されます。スクリプトとは違い、パフォーマンス上の高い要求のために、プラグインはサポートしたい任意のプラットフォーム用に、できればプラットフォーム専用の最適化も含めて、コンパイルする必要があります。</p></li>
<li><p>C# で開発される GUI。GUI は任意であることに注意してください。そのため、常に基本的なネイティブ DSP プラグインを作成することから、プラグイン開発を始める事ができ、ネイティブプラグインで公開しているパラメーター設定のためのデフォルトのスライダーベース UI は Unity に表示させます。どのようなプロジェクトも初めの段階は、このアプローチをお勧めします。</p></li>
</ol>

<p>最初に C# GUI を .cs ファイルとして Assets/Editor フォルダーにドロップするだけで (他のエディタースクリプトと同様に) プロトタイプを作成できます。後にコードが長くなり、より適切なモジュール化と IDE サポートが必要になってきたら、適切な Visual Studio プロジェクトに移動できます。これにより、.dll ファイルにコンパイルでき、ユーザーがプロジェクトに簡単にドロップできるようになり、コードを保護しやすくなります。</p>

<p>また、ネイティブ DSP と GUI DLL は両方とも複数のプラグインを含むことができ、そのバインディングは DLL 名に関係なく、プラグイン内のエフェクト名を通してのみ発生する事に気をつけてください。</p>

<h2>すべてのこれらのファイルは何だろう？</h2>

<p>ネイティブな面では、プラグイン SDK は実際は 1 つのファイル (AudioPluginInterface.h) からできていますが、同じ DLL 内に複数のプラグインエフェクトを含めることが簡単にできます。シンプルな統合された方法 (AudioPluginUtil.h と AudioPluginUtil.cpp) で、エフェクト定義とパラメーター登録の制御をサポートするコードを追加しました。NativePluginDemo プロジェクトには、役に立つ多くのサンプルプラグインが含まれており、ゲームコンテキストで役立つさまざまな種類のプラグインを紹介します。このコードはパブリックドメインになっているので、開発の出発点としてコードを自由に使ってください。</p>

<p>プラグインの開発は、プラグインに必要なパラメータの定義から始めます。開発を始める前に、プラグインが配置するすべてのパラメータの詳細なマスタープランを持っている必要はありません。しかし、ユーザーにどんな経験をしてもらいたいか、どのコンポーネントが必要になってくるかについての大まかなアイデアを持っていると良いでしょう。</p>

<p>提供するプラグインのサンプルには、使いやすいユーティリティ関数がたくさん含まれています。
“Ring Modulator” プラグイン例を見てみましょう。このシンプルなプラグインは、正弦波で入力される信号を掛け合わせます。特に、周波数が異なる複数のリングモジュレーション効果が連鎖すると、ラジオノイズ/壊れた受信機のようなエフェクトを与えます。</p>

<p>サンプルプラグインでパラメータを処理するための基本的なスキームは、それらを enum 値として定義することです。これは、便利さと簡潔さの両方のために、float の配列へのインデックスとして使用します。</p>

<pre><code>enum Param
{
    P_FREQ,
    P_MIX,
    P_NUM
};

int InternalRegisterEffectDefinition(UnityAudioEffectDefinition&amp; definition)
{
    int numparams = P_NUM;
    definition.paramdefs = new UnityAudioParameterDefinition [numparams];
    RegisterParameter(definition, "Frequency", "Hz",
        0.0f, kMaxSampleRate, 1000.0f,
        1.0f, 3.0f,
        P_FREQ);
    RegisterParameter(definition, "Mix amount", "%",
        0.0f, 1.0f, 0.5f,
        100.0f, 1.0f,
        P_MIX);
    return numparams;
}
</code></pre>

<p>RegisterParameter 呼び出しの数字は、最小値、最大値、デフォルト値、そして表示のみに使用するスケーリング係数が続きます。すなわち、パーセント値の場合は、実際の値は
0 から 1 で、表示されるときは 100 で積算されます。このためのカスタム GUI コードはありませんが、前述したように Unity はこれらの基本的なパラメーター定義からデフォルトの GUI を生成します。未定義のパラメーターをチェックするシステムはありません。そのため、AudioPluginUtil システムは、宣言されたすべての enum 値 (<code>P_NUM</code> は除く) は、対応するパラメーター定義と一致すると想定します。</p>

<p>舞台裏では RegisterParameter 関数は、そのプラグインに関連付けられている (“AudioEffectPluginInterface.h” を参照) UnityAudioEffectDefinition 構造体の UnityAudioParameterDefinition 配列のエントリに記入します。UnityAudioEffectDefinition で設定される必要がある残り部分は関数へのコールバックで、プラグインの初期化 (CreateCallback)、パラメーターの設定/取得 (<code>SetFloatParameterCallback/ UnityAudioEffect_GetFloatParameterCallback</code>)、実際の処理 (<code>UnityAudioEffect_ProcessCallback</code>) を行い、 終了後、最終的にプラグインのインスタンスを破棄します (<code>UnityAudioEffect_ReleaseCallback</code>)。</p>

<p>同じ DLL で複数のプラグインを持つことを簡単にするために、各プラグインは、独自の名前空間に収納されています。コールバック関数のための特定の命名規則が使用され、例えば、<code>DEFINE_EFFECT</code> と <code>DECLARE_EFFECT</code> マクロは UnityAudioEffectDefinition 構造体に記入できます。内部では、すべてのエフェクトの定義は、ライブラリ UnityGetAudioEffectDefinitions の唯一のエントリポイントでポインターが返される配列に格納されます。</p>

<p>これは、VST や AudioUnits など他のプラグイン形式や、Unity オーディオプラグインインターフェースからマップするブリッジプラグインを開発したい場合、知っておくと便利です。その場合、ロード時にパラメーターの記述を設定する、より動的な方法を開発する必要があります。</p>

<h3>プラグインのインスタンス化</h3>

<p>次は、プラグインのインスタンスのデータです。プラグイン例では、EffectData 構造体にすべてのデータを置きます。これの割り当ては、ミキサー内のプラグインのインスタンスごとに呼び出される対応した CreateCallback で発生する必要があります。この簡単な例では、すべてのチャネルに掛け合わせた 1 つの正弦波があり、他のより高度なプラグインは、入力チャンネル毎に追加データを割り当てる必要があります。</p>

<pre><code>struct EffectData
{
    struct Data
    {
        float p[P_NUM]; // パラメーター
        float s;        // オシレーターの正弦出力
        float c;        // オシレーターの余弦出力
    };
    union
    {
        Data data;
        unsigned char pad[(sizeof(Data) + 15) &amp; ~15];
    };
};
</code></pre>

<pre><code>UNITY_AUDIODSP_RESULT UNITY_AUDIODSP_CALLBACK CreateCallback(
    UnityAudioEffectState* state)
{
    EffectData* effectdata = new EffectData;
    memset(effectdata, 0, sizeof(EffectData));
    effectdata-&gt;data.c = 1.0f;
    state-&gt;effectdata = effectdata;
    InitParametersFromDefinitions(
        InternalRegisterEffectDefinition, effectdata-&gt;data.p);
    return UNITY_AUDIODSP_OK;
}
</code></pre>

<p>UnityAudioEffectState は、サンプリングレート、(タイミング) 処理されるサンプルの総数、プラグインがバイパスされているか、すべてのコールバック関数にするか、などのホストからの様々なデータを含んでおり、すべてのコールバック関数に渡されます。</p>

<p>そして、もちろん、プラグインインスタンスをフリーにするために、対応する機能もあります。</p>

<pre><code>UNITY_AUDIODSP_RESULT UNITY_AUDIODSP_CALLBACK ReleaseCallback(
    UnityAudioEffectState* state)
{
    EffectData::Data* data = &amp;state-&gt;GetEffectData&lt;EffectData&gt;()-&gt;data;
    delete data;
    return UNITY_AUDIODSP_OK;
}
</code></pre>

<p>オーディオの主な処理は ProcessCallback で起こります。</p>

<pre><code>UNITY_AUDIODSP_RESULT UNITY_AUDIODSP_CALLBACK ProcessCallback(
    UnityAudioEffectState* state,
    float* inbuffer, float* outbuffer,
    unsigned int length,
    int inchannels, int outchannels)
{
    EffectData::Data* data = &amp;state-&gt;GetEffectData&lt;EffectData&gt;()-&gt;data;

    float w = 2.0f * sinf(kPI * data-&gt;p[P_FREQ] / state-&gt;samplerate);
    for(unsigned int n = 0; n &lt; length; n++)
    {
        for(int i = 0; i &lt; outchannels; i++)
        {
            outbuffer[n * outchannels + i] =
                inbuffer[n * outchannels + i] *
                (1.0f - data-&gt;p[P_MIX] + data-&gt;p[P_MIX] * data-&gt;s);
        }
        data-&gt;s += data-&gt;c * w; // cheap way to calculate a sine-wave
        data-&gt;c -= data-&gt;s * w;
    }

    return UNITY_AUDIODSP_OK;
}
</code></pre>

<p>上の方の GetEffectData 関数は、上で宣言した構造体の EffectData::Data に状態変数の effectdata フィールドをキャストするヘルパー関数です。</p>

<p>含まれる他のシンプルなプラグインは、NoiseBox プラグインです。これは、可変周波数でのホワイトノイズ、または Lofinator のプラグインの入力信号を加えて、掛け合わせ、シンプルにダウンサンプリングし、信号の量子化を行います。これらのすべては組み合わたり、ゲーム用のアニメーションのパラメーターと一緒に用いられ、携帯電話から通信状態が悪い携帯無線、壊れた拡声器まで、あらゆるものをシミュレーションすることができます。</p>

<p>StereoWidener は、可変遅延で mono (モノラル) や side コンポーネントにステレオ入力信号を分解し、その後、それらをステレオ効果の感覚を高めるために再結合します。</p>

<figure>
<img src="../uploads/Main/AudioMixerStereoWidener.jpg" alt="手始めに必要なカスタム GUI 無しのシンプルなプラグイン">
<figcaption>手始めに必要なカスタム GUI 無しのシンプルなプラグイン</figcaption>
</figure>

<h2>どのプラットフォームにどのプラグインをロードする？</h2>

<p>ネイティブオーディオプラグインは、プラグインのインポーターインスペクター経由で、それぞれのプラットフォームに関連付けられてなければならないので、他のネイティブまたはマネージプラグインと同じスキームを使用します。プラグインを置くためのサブディレクトリに関する詳しい情報は <a href="PluginsForDesktop.html">こちらのページ</a> を参照してください。プラットフォームの関連付けが必要なため、システムは、スタンドアロンビルドの各ビルドターゲットにどのプラグインを含むべきかを知っています。64 ビットサポートの導入によって、同じプラットフォーム内でもこれを指定する必要があります。Universal Binary 形式は、同じバンドル内に 32 ビットと 64 ビットの両方のバリアントを含むのを許可しています。</p>

<p>マネージコードから呼び出される Unity のネイティブプラグインは、ネイティブ DLL からインポートする関数を参照している [DllImport] 属性を使用してロードされます。しかし、ネイティブオーディオプラグインの場合、事情が違います。ここで起こる特別な問題は、プラグインからエフェクトを必要とするかもしれないミキサーアセットの作成が開始される前にオーディオプラグインをロードする必要があるということです。エディターでは、これは問題ありません。プラグインに依存するミキサーをリロードやリビルドできるからです。しかし、スタンドアロンビルドでは、ミキサーアセットを作成する前にプラグインがロードされなければなりません。この問題を解決するには、現在のやり方は、プラグインの DLL に “audioplugin” (大文字小文字を区別しない) を付けることです。そのため、システムはこれを検出することができ、自動的に起動時にロードされるプラグインのリストに追加します。Unity のミキサー内に表示されるエフェクトの名前を定義するのは、プラグイン内の定義のみです。DLL は何でも呼び出すことができますが、検出されるためには、文字列が “audioplugin” で始まる必要があります。</p>

<p>iOS のようなプラットフォームには、プラグインコードは、作成された XCode プロジェクトによって生成される Unity のバイナリに静的にリンクされる必要があります。そして、そこに (プラグインのレンダリングデバイスと同じように) プラグインの登録をアプリケーションの起動コードに明示的に追加する必要があります。 </p>

<figure>
<img src="../uploads/Main/AudioMixerPlugins.png" alt="">
</figure>

<p>OSX上で1つのバンドルには、32ビットおよび64ビット版の両方のプラグインを含むことができます。また、サイズを保存するためにそれらを分割することができます。</p>

<h3>カスタム GUI を持つプラグイン</h3>

<p>今度は、もう少し高度な応用例を見てみましょう。イコライゼーションとマルチバンド圧縮のためのエフェクトです。このようなプラグインは、前述したシンプルなプラグインよりも、はるかにパラメーター数が多く、パラメーター間にいくつかの物理的な結合があります。このような場合、パラメーターの可視化をするために、単にたくさんのシンプルなスライダーを使うよりも上手い方法が必要です。インスタンスのためのイコライザーを考えてみましょう。各帯域には、まとまって最終的なイコライゼーションカーブに影響する 3 つの異なるフィルターがあります。このフィルターはそれぞれ、周波数、Q 値、ゲインの 3 つのパラメーターを持ち、これらのパラメーターは物理的に関連付けられ、各フィルターの形状を定義します。そのため、イコライザープラグインが結果の曲線を示す大きなディスプレイを持ち、1 つずつスライダーを変更するよりも、簡単なドラッグ操作で複数のパラメーターを同時に設定することが、大いに役立ちます。</p>

<figure>
<img src="../uploads/Main/AudioMixerCustomGUI.png" alt="">
</figure>

<p>イコライザープラグインのカスタム GUI。フィルターカーブのゲインと周波数を変更するには 3 つの帯域をドラッグします。各帯域の形状を変更するためにシフトボタンを押しながらドラッグしてください。</p>

<p>つまり、定義、初期化、初期化解除、パラメーターの処理は、単純なプラグインに使用されるのとまったく同じ enum ベースのメソッドに従います。さらに、ProcessCallback コードは短くなります。さて、ネイティブコードを見るのはこれくらいにして、Visual Studio で AudioPluginDemoGUI.sln プロジェクトを開きます。GUI コードに関連する C# クラスが表示されます。どのように動作するかは簡単です。Unity がネイティブのプラグイン DLL を読み込み、含まれているオーディオプラグインを登録すると、登録されたプラグインの名前と一致する GUI を探し始めます。これは、EqualizerCustomGUI クラスの Name プロパティによって可能です。EqualizerCustomGUI は、すべてのカスタムプラグイン GUI と同様に、IAudioEffectPluginGUI から継承しなければなりません。このクラスの重要な関数は bool OnGUI ( IAudioEffectPlugin プラグイン) 関数です。IAudioEffectPlugin プラグイン引数を通して、この関数はネイティブプラグインが定義したパラメーターを読み書きするのに使用するネイティブプラグインのハンドルを取得します。そのため、パラメーターを読み込むには以下を呼び出します。</p>

<pre><code>plugin.GetFloatParameter("MasterGain", out masterGain);
</code></pre>

<p>パラメーターが見つかると、true を返し、パラメーターを設定し、以下を呼び出します。</p>

<pre><code>plugin.SetFloatParameter("MasterGain", masterGain);
</code></pre>

<p>これも、パラメーターが存在する場合は true を返します。そして、それが基本的に GUI とネイティブコード間のもっとも重要な連携です。また、以下の関数を使用してパラメーター “NAME” の最小値、最大値、デフォルト値をクエリし、ネイティブと UI コード内のこれらの定義と重複するのを避けることもできます。</p>

<pre><code>plugin.GetFloatParameterInfo("NAME", out minVal, out maxVal, out defVal);
</code></pre>

<p>独自の OnGUI 関数が true を返す場合には、インスペクターのカスタム GUI 下にデフォルトの UI スライダーが表示されます。これもまた、独自のカスタム GUI を開発のために便利です。なぜなら、独自のカスタム GUI の開発中にすべてのパラメーターが使用可能で、すべてのパラメータを持っていて、正しいアクションを実行すると、期待通りパラメーターが変更されることを簡単に確認できるからです。</p>

<p>ここでは、イコライザーとマルチバンドのプラグインで発生している DSP 処理の詳細については説明しません。興味がある人のために述べると、フィルターは Robert Bristow Johnson の優れた Audio EQ Cookbook から使用し、カーブを作成するために、Unity はいくつかの内部API関数を使用して周波数応答のアンチエイリアシングカーブを描きます。</p>

<p>もう 1 つ言及すると、イコライザーとマルチバンドのプラグインの両方が、入力スペクトルと出力スペクトルを重ねてプラグインの効果を可視化するコードも提供することです。これは興味深い問題を提起します。GIU コードはオーディオ処理よりもずっと低い更新レート ( フレームレート) で実行され、オーディオストリームにアクセスできません。それでは、このデータをどのように読み取れば良いでしょうか。 このために、ネイティブコードには特別な関数があります。</p>

<pre><code>UNITY_AUDIODSP_RESULT UNITY_AUDIODSP_CALLBACK GetFloatParameterCallback(
    UnityAudioEffectState* state,
    int index,
    float* value,
    char *valuestr)
{
    EffectData::Data* data = &amp;state-&gt;GetEffectData&lt;EffectData&gt;()-&gt;data;
    if(index &gt;= P_NUM)
        return UNITY_AUDIODSP_ERR_UNSUPPORTED;
    if(value != NULL)
        *value = data-&gt;p[index];
    if(valuestr != NULL)
        valuestr[0] = 0;
  return UNITY_AUDIODSP_OK;
}
</code></pre>

<p>これは単に、ネイティブプラグインからの浮動小数点データの配列を読むことを可能にします。そのデータが何であれ、プラグインシステムはリクエストが著しく UI またはネイティブコードを遅くしない限り問題ではありません。イコライザーとマルチバンドコード用に、プラグインから入出力データを供給し、スペクトルを返すことを容易にする FFTAnalyzer と呼ばれるユーティリティクラスがあります。それから、このスペクトルデータは GetFloatBufferCallback によってリサンプリングされて、C# の UI コードに渡されます。データがリサンプリングされる理由は、GetFloatBufferCallback が要求されたサンプル数 (データを表示するビューの幅によって決まります) を返すのに対し、FFTAnalyzer は固定周波数分解能で分析を実行します。最小限の DSP コードを持つとても簡単なプラグインについて、CorrelationMeter のプラグインを見てみましょう。それは、単に信号がどの程度ステレオであるかを示すために、右チャンネルの振幅に対して左チャンネルの振幅を単純に作成します。</p>

<figure>
<img src="../uploads/Main/AudioMixerDemoCorrelationMeter.png" alt="">
</figure>

<figure>
<img src="../uploads/Main/AudioMixerDemoMultiband.jpg" alt="">
</figure>

<p>上は CorrelationMeter プラグインのカスタム GUI。</p>

<p>下は、イコライザーGUI とスペクトル分析 (緑のカーブがソース、赤は処理後)。</p>

<p>この時点で、イコライザーとマルチバンドエフェクトの両方が意図的にシンプルかつ最適化されずに保持されていることを指摘したいと思います。しかし、それらはプラグインシステムでサポートされるより複雑な UI の良い例だと考えます。関連するプラットホーム特有の最適化を行うには、たくさんのパラメータの調整して、本当にぴったりだと感じ、もっとも音楽的に思えるようにするなど、明らかにやるべきことがたくさんあります。Unity のプラグインの標準レパートリーを増やす便宜のために、ある時点で、これらのエフェクトのいくつかを Unity のビルトインのプラグインとして実装するかもしれません。しかし、ユーザーもこの難題に立ち向かい本当に良いプラグインを作成してくださるよう心から願っています。それに、ある時点で、それらがビルトインプラグインになっていないとも限りません。</p>

<figure>
<img src="../uploads/Main/AudioMixerDemoConvolutionReverb.png" alt="">
</figure>

<p>コンボリューションリバーブのプラグイン例。インパルス応答は、パラメーターによって定義される減衰するランダムノイズです。リリース用のプラグインでは任意に記録されたインパルスをユーザーがロードできるようにしなければならないので、これはデモンストレーションのためだけに限られます。基本となるコンボリューションアルゴリズムは変わりません。</p>

<figure>
<img src="../uploads/Main/AudioMixerDemoLoudnessMeter.png" alt="">
</figure>

<p>3 つの異なる時間スケールでレベルを測定するラウドネスモニターツールの例。
これもデモンストレーションを目的としたものですが、現在良く使われるラウドネス標準に準拠しており、モニターツールの構築し始めに適しています。 カーブレンダリングコードは Unity に組み込まれています。</p>

<h3>DSP クロックに同期させる</h3>

<p>楽しいエクササイズの時間です。単に処理するのではなく、プラグインシステムを使ってサウンドを生成してみましょう。アシッドトランスを聴く人になじみのあるシンプルなベースラインとドラムシンセサイザーを試してみましょう。このジャンルを定義したいくつかの主要シンセサイザーのシンプルなクローンです。Plugin_TeeBee.cpp と Plugin_TeeDee.cpp を見てください。これらのシンプルなシンセサイザーは、ランダムな音を使ってパターンを生成するだけで、シンセサイザーエンジンでフィルター、エンベロープなどを微調整するためのいくつかのパラメーターを持っています。繰り返しますが、ここではそれらの詳細については説明しませんが、state-&gt;dsptick パラメーターが ProcessCallback で読み取られて、曲内の位置を決定するということを指摘しておきます。このカウンターはグローバルなサンプル位置なので、サンプルで指定された各音符の長さでそれを除算し、この除算の余りがゼロになるたびに音符イベントをシンセサイザーエンジンに送信します。こうすることで、すべてのプラグインエフェクトが同じサンプルベースの時計に同期したままになります。例えば、そのようなエフェクトを通して既知のテンポで音楽を再生する場合は、タイミング情報を使用して音楽にテンポが同期されるフィルターエフェクトを適用したり、音楽を遅延させたりできます。</p>

<figure>
<img src="../uploads/Main/AudioMixerDemoTeeBee3o3.png" alt="">
</figure>

<figure>
<img src="../uploads/Main/AudioMixerDemoTeeDee9o9.png" alt="シンプルなベースラインとドラムシンセサイザーでテンポが同期されるエフェクトをデモします。">
<figcaption>シンプルなベースラインとドラムシンセサイザーでテンポが同期されるエフェクトをデモします。</figcaption>
</figure>

<h2>Spatialization (立体化)</h2>

<p>ネイティブのオーディオプラグイン SDK は Spatialization SDK の基礎で、オーディオソースごとにインスタンス化するカスタムの立体化エフェクトの開発を可能にします。
詳しい情報は <a href="AudioSpatializerSDK.html">Audio Spatializer SDK</a> を参照してください。</p>

<h2>展望</h2>

<p>これは、ちょうど、サウンドシステムの一部を高性能のネイティブコードへと向かうための努力の第一歩にすぎません。これを Unity の他の部分にも統合してエフェクトをミキサーの外部で使用できるようにするとともに、SDK を拡張して float 以外のパラメータータイプをサポートし、より優れたデフォルトの GUI やバイナリデータの保存をサポートする予定です。</p>

<p>独自のプラグインを作成して楽しんでください。アセットストアでそれらを拝見するのが楽しみです。</p>

<h2>お断わり</h2>

<p>設計に多くの類似持性はありますが、Unity のネイティブのオーディオ SDK は Steinberg VST や Apple AudioUnits など他のプラグイン SDK の上に作成されたものではありません。興味があるユーザーが、他のプラグイン SDK を Unity で使用するために、ネイティブオーディオ SDK を利用して基本ラッパーを実装するのはたやすいことでしょう。しかし、それは、Unity の開発チームが意図していることではありません。どんなプラグインの適切なホスティングも、あっという間にとても複雑になります。予想される呼び出し順序の複雑さへの対処や、ネイティブコードの急速な増大によるカスタム GUI 画面の処理などが急速に拡大し、コード例としてあまり役立ちません。</p>

<p>VST や AU プラグインや、サウンドデザインを単に模写したりテストするためのエフェクトでさえ、ロードするととても役立つ可能性があるということを理解する反面、VST/AU の使用は、数種の特定のプラットフォームに制限されるということに注意してください。Unity SDK に基づいてオーディオプラグインを書く利点は、それがソフトウェアミキシングや動的に読み込んだネイティブコードに対応しているすべてのプラットフォームで拡張可能だという点です。とはいえ、カスタムプラグインの開発に時間を費やすこと (または、単に、エディター内でどちらにせよサウンドを変えない計測プラグインを使用すること) を決める前に、早期のサウンドデザインを好みのツールで模写するのに利用できる事例もあります 。何かよい解決案のあるひとは、やってみてください。</p>

<hr>

<ul>
<li><p><span class="page-edit">2018–03–19 修正されたページ</span></p></li>
<li><p><span class="page-history">MonoDevelop は 2018.1 以降 Visual Studio に置き換えられました</span></p></li>
</ul>
<!-- area:authoring -->
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="AudioMixerUsage.html"></a></span><div class="tip">用途と API の概要</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="AudioSpatializerSDK.html"></a></span><div class="tip">オーディオスペーシャライザー SDK</div>
</div>
</div>
</div>
<div style="display: flex; flex-flow: row wrap; border-top: #e6e6e6 1px solid; color: #455463; font-size: 14px; padding-top: 2px;"> <div style="display: flex; flex-flow: column nowrap; margin-right: 30px; width: 600px;"> <div style="display: flex; align-items: center;"> <div style="margin-right: 15px"> Copyright © 2020 Unity Technologies </div><div> 优美缔软件（上海）有限公司 版权所有 </div></div><div style="margin: 15px 0 5px 0;"> "Unity"、Unity 徽标及其他 Unity 商标是 Unity Technologies 或其附属机构在美国及其他地区的商标或注册商标。其他名称或品牌是其各自所有者的商标。 </div><div style="display: flex; flex-flow: row wrap; align-items: center; line-height: 20px;"> <div style="width: 20px; height: 20px; background-image: url('https://unity-cn-cdn-prd.unitychina.cn/assets/styles/i/china.d0289dc0a46fc5b15b3363ffa78cf6c7.png'); margin-right: 4px;"></div><div style="margin-right: 2px;">公安部备案号:</div><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=31010902002961" target="_blank" style="color: #00CCCC !important; cursor: pointer; text-decoration: none;">31010902002961</a> </div></div><div> <div style="display: flex; flex-flow: row wrap; align-items: center; margin-bottom: 20px;"> <a href="/legal" target="_blank" style="margin-right: 10px; text-decoration: none; color: #00CCCC !important">法律条款</a> <a href="/legal/privacy-policy" target="_blank" style="margin-right: 10px; text-decoration: none; color: #00CCCC !important">隐私政策</a> <a href="/legal/cookie-policy" target="_blank" style="margin-right: 10px; text-decoration: none; color: #00CCCC !important">Cookies</a> </div><div> <a href="http://beian.miit.gov.cn" style="text-decoration: none; color: #00CCCC !important">沪ICP备13002771号-8</a> </div></div></div>
<script type="text/javascript">(function(){var id="io6j3s669rgbrhnozmfzh8r2mf204n7q70a";var js=document.createElement("script");js.setAttribute("type","text/javascript");js.setAttribute("src","//deploy.mopinion.com/js/pastease.js");document.getElementsByTagName("head")[0].appendChild(js);var t=setInterval(function(){try{new Pastease.load(id);clearInterval(t)}catch(e){}},50)})();</script>
</body>
</html>
